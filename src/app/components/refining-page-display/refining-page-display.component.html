

<ion-grid>
  <ion-row>
    <ion-col>
      <ion-card>
        <ion-card-header>
          <ion-card-title>Crafting Queue</ion-card-title>
        </ion-card-header>

        <ion-card-content>
          <ng-container>
            <div *ngIf="currentQueue.queue.length === 0">No items currently being crafted.</div>

            <ion-list>
              <ion-item *ngFor="let craftItem of currentQueue.queue || []; let i = index; trackBy:trackBy">
                <app-game-icon slot="start" [icon]="iconForRecipe(craftItem.recipe)"></app-game-icon>

                <ion-label>
                  <h2>{{ craftItem.recipe.result }} x{{ craftItem.totalLeft }} &middot; <app-countdown [duration]="craftItem.currentDuration"></app-countdown></h2>
                </ion-label>

                <ion-button color="danger" slot="end" fill="clear" (click)="cancel(i)" [analyticsClick]="'Refining:' + tradeskill + ':Cancel:' + craftItem.recipe.result">Cancel</ion-button>
              </ion-item>
            </ion-list>
          </ng-container>
        </ion-card-content>
      </ion-card>
    </ion-col>
  </ion-row>

  <ion-row>
    <ion-col>
      <ion-card>
        <ion-card-content>
          <ion-row>
            <ion-col>
              <ion-item (click)="changeOption('hideDiscovered', !filterOptions.hideDiscovered)">
                <ion-checkbox slot="start" [checked]="filterOptions.hideDiscovered"></ion-checkbox>
                <ion-label>Hide Discovered</ion-label>
              </ion-item>
            </ion-col>

            <ion-col>
              <ion-item (click)="changeOption('hideNew', !filterOptions.hideNew)">
                <ion-checkbox slot="start" [checked]="filterOptions.hideNew"></ion-checkbox>
                <ion-label>Hide Undiscovered</ion-label>
              </ion-item>
            </ion-col>

            <ion-col>
              <ion-item (click)="changeOption('hideHasIngredients', !filterOptions.hideHasIngredients)">
                <ion-checkbox slot="start" [checked]="filterOptions.hideHasIngredients"></ion-checkbox>
                <ion-label>Hide Creatable</ion-label>
              </ion-item>
            </ion-col>

            <ion-col>
              <ion-item (click)="changeOption('hideHasNoIngredients', !filterOptions.hideHasNoIngredients)">
                <ion-checkbox slot="start" [checked]="filterOptions.hideHasNoIngredients"></ion-checkbox>
                <ion-label>Hide Uncreatable</ion-label>
              </ion-item>
            </ion-col>
          </ion-row>
        </ion-card-content>
      </ion-card>
    </ion-col>
  </ion-row>

  <ion-row>
    <ion-col>
      <ion-card>
        <ion-card-content>
          <ion-segment class="mb-1" [(ngModel)]="type">
            <ion-segment-button value="resources" [disabled]="resourceRecipes.length === 0">
              Craftable Resources ({{ resourceRecipes.length }})
            </ion-segment-button>

            <ion-segment-button value="items" [disabled]="itemRecipes.length === 0">
              Craftable Items ({{ itemRecipes.length }})
            </ion-segment-button>
          </ion-segment>

          <ion-list class="scrollable-list">
            <ion-item *ngFor="let recipe of type === 'resources' ? resourceRecipes : itemRecipes; trackBy: trackBy">
              <app-game-icon slot="start" [icon]="iconForRecipe(recipe)" [shimmer]="!discoveries[recipe.result]"></app-game-icon>

              <ion-label>
                <h2>
                  <strong>{{ recipe.result }}</strong>
                  <div class="resource-notifier" *ngIf="type === 'resources'">
                    <small>You have {{ resources[recipe.result] || 0 | number }} of these.</small>
                  </div>
                </h2>

                <div class="resources">
                  <app-time-resource-icon [time]="recipe.craftTime * (amounts[recipe.result] || 1)"
                                          [inlineIconSize]="true"
                                          [emphasizeText]="false"></app-time-resource-icon>

                  <app-resource-icon [name]="resource.key"
                                      [quantity]="recipe.preserve?.includes(resource.key) ? resource.value : resource.value * (amounts[recipe.result] || 1)"
                                      [maxQuantity]="resources[resource.key] || 0"
                                      [showX]="true"
                                      [inlineIconSize]="true"
                                      [emphasizeText]="false"
                                      [angryColorWhenQuantityExceedsMax]="true"
                                      *ngFor="let resource of recipe.ingredients | keyvalue"></app-resource-icon>
                </div>
              </ion-label>

              <div slot="end">
                <ion-grid>
                  <ion-row>
                    <ion-col class="craft-buttons">
                      <ion-button color="primary" fill="outline" (click)="modifyAmount(recipe, -1)" [disabled]="!amounts[recipe.result] || amounts[recipe.result] <= 1">-</ion-button>
                      <div class="amount">{{ amounts[recipe.result] || 1 }}</div>
                      <ion-button color="primary" fill="outline" (click)="modifyAmount(recipe, 1)">+</ion-button>
                      <ion-button class="craft"
                                  fill="clear"
                                  (click)="craft(recipe, amounts[recipe.result] || 1)"
                                  [disabled]="isQueueFull(currentQueue) || !canCraftRecipes[recipe.result]"
                                  [class.no-skillups]="level >= recipe.level.max"
                                  [analyticsClick]="'Refining:' + tradeskill + ':Craft:' + recipe.result">Craft</ion-button>
                    </ion-col>
                  </ion-row>

                  <ion-row *ngIf="recipe.maxWorkers > 0 && refiningWorkers.hasWorkers">
                    <ion-col class="worker-buttons">
                      <ion-button color="secondary" fill="outline" (click)="unassignWorker(recipe)" [disabled]="(workersPerRecipe[recipe.result] || 0) <= 0"
                                  [analyticsClick]="'Refining:' + tradeskill + ':RemoveWorker:' + recipe.result">-</ion-button>
                      <div class="amount">{{ (workersPerRecipe[recipe.result] || 0) | number }}/{{ recipe.maxWorkers }}</div>
                      <ion-button color="secondary" fill="outline" (click)="assignWorker(recipe)" [disabled]="(workersPerRecipe[recipe.result] || 0) >= recipe.maxWorkers || !refiningWorkers.canAssignWorker"
                                  [analyticsClick]="'Refining:' + tradeskill + ':AddWorker:' + recipe.result">+</ion-button>
                    </ion-col>
                  </ion-row>
                </ion-grid>
              </div>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>
    </ion-col>
  </ion-row>
</ion-grid>
